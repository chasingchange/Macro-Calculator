<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chasing Change — Macro Calculator</title>
    <meta
      name="description"
      content="Chasing Change macro calculator to estimate calories + macros based on your goal and activity level."
    />

    <!-- Tailwind via CDN (embed-friendly) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700&family=Museo+Moderno:wght@500;700&family=Raleway:wght@500;700;800&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cc: {
                text: "#071f35",
                bg: "#f5f5f7",
                outline: "#77d770",
                card: "#ffffff",
              },
            },
            fontFamily: {
              body: ["Mulish", "system-ui", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "sans-serif"],
              heading: ["Raleway", "system-ui", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "sans-serif"],
              brand: ["Museo Moderno", "Raleway", "sans-serif"],
            },
            boxShadow: {
              soft: "0 10px 30px rgba(7,31,53,0.10)",
              outline: "0 0 0 1px rgba(119,215,112,0.55)",
              glow: "0 10px 50px rgba(119,215,112,0.25)",
            },
          },
        },
      };
    </script>

    <style>
      html,
      body {
        height: 100%;
      }
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* CENTER AND SPACE */
      main {
        margin-bottom: 2rem;
      }

      /* RESULTS STYLING */
      #results > .rounded-2xl {
        border-width: 2px;
        border-color: #77d770;
      }
    </style>
  </head>

  <body class="min-h-screen bg-cc-bg text-cc-text font-body">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-6 sm:py-10">
      <div class="mx-auto max-w-xl">
        <!-- Header -->
        <header class="mb-3 sm:mb-4">
          <div class="rounded-3xl overflow-hidden ring-1 ring-black/5 shadow-soft bg-white">
            <div class="relative p-6 sm:p-8">
              <!-- background flair -->
              <div class="absolute -top-24 -right-24 w-72 h-72 rounded-full bg-cc-outline/20 blur-3xl"></div>
              <div class="absolute -bottom-28 -left-28 w-80 h-80 rounded-full bg-cc-text/10 blur-3xl"></div>

              <!-- IMPORTANT: stack on mobile, row on desktop -->
              <div class="relative flex flex-col sm:flex-row sm:items-center justify-between gap-6">
                <!-- LEFT: Brand + Title -->
                <div class="flex items-center gap-4">
                  <!-- Logo -->
                  <div class="w-14 h-14 sm:w-16 sm:h-16 flex-shrink-0 flex items-center justify-center">
                    <img
                      src="Chasing Change Logo2.png"
                      alt="Chasing Change logo"
                      class="w-full h-auto"
                    />
                  </div>

                  <!-- Text stack -->
                  <div class="flex flex-col">
                    <p class="text-xs sm:text-sm tracking-[0.3em] uppercase font-brand opacity-60">
                      Chasing Change
                    </p>

                    <h1 class="mt-1 text-2xl sm:text-3xl font-extrabold font-heading leading-tight">
                      Macro Calculator
                    </h1>
                  </div>
                </div>

                <!-- RIGHT: CTA (desktop) -->
                <div class="hidden sm:flex flex-col items-center">
                  <a
                    href="https://tally.so/r/w5JXKE"
                    target="_blank"
                    rel="noreferrer"
                    class="group inline-flex items-center justify-center gap-2 rounded-2xl px-5 py-3
                           text-sm font-extrabold bg-cc-text text-white hover:opacity-95 transition shadow-soft"
                  >
                    Apply for Coaching
                    <span
                      class="inline-flex items-center justify-center w-8 h-8 rounded-xl
                             bg-white/10 ring-1 ring-white/15 group-hover:bg-white/15 transition"
                      aria-hidden="true"
                    >
                      →
                    </span>
                  </a>

                  <p class="mt-2 text-xs opacity-60 text-center">Systems-Based Transformations</p>
                </div>

                <!-- Mobile CTA -->
                <div class="sm:hidden">
                  <a
                    href="https://tally.so/r/w5JXKE"
                    target="_blank"
                    rel="noreferrer"
                    class="inline-flex w-full items-center justify-center gap-2 rounded-2xl px-5 py-4 text-sm font-extrabold
                           bg-cc-text text-white hover:opacity-95 transition shadow-soft"
                  >
                    Apply for Coaching →
                  </a>
                  <p class="mt-2 text-xs opacity-60 text-center">Systems-Based Coaching</p>
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- App Card -->
        <div class="flex justify-center">
          <main class="w-full max-w-xl rounded-3xl bg-cc-card shadow-soft ring-1 ring-black/5 overflow-hidden">
            <div class="p-5 sm:p-8">
              <div class="flex items-start gap-3 mb-6">
                <div class="w-10 h-10 rounded-xl bg-cc-outline/15 ring-1 ring-cc-outline/40 flex items-center justify-center">
                  <svg viewBox="0 0 24 24" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/>
                    <path d="M9 6h6"/>
                    <path d="M9 10h6"/>
                    <path d="M9 14h2"/>
                    <path d="M13 14h2"/>
                    <path d="M9 18h2"/>
                    <path d="M13 18h2"/>
                  </svg>
                </div>

                <div>
                  <h2 class="text-lg sm:text-xl font-bold font-heading">Input Your Stats</h2>
                  <p class="text-sm opacity-80">Fill this out today. Run your race tomorrow.</p>
                </div>
              </div>

              <div class="space-y-5">
                <!-- Units toggle -->
                <div class="rounded-2xl p-4 bg-black/5 ring-1 ring-black/5">
                  <div class="flex items-center justify-between gap-3 flex-wrap">
                    <div>
                      <p class="text-sm font-semibold">Units</p>
                      <p class="text-xs opacity-70">Choose US (lbs / ft) or Metric (kg / cm).</p>
                    </div>
                    <div class="inline-flex rounded-2xl bg-white ring-1 ring-black/10 p-1">
                      <button id="unitUS" type="button" class="unitBtn px-4 py-2 rounded-xl text-sm font-bold bg-cc-outline/20 ring-1 ring-cc-outline/30">
                        US
                      </button>
                      <button id="unitMetric" type="button" class="unitBtn px-4 py-2 rounded-xl text-sm font-bold opacity-70 hover:opacity-100">
                        Metric
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Weight -->
                <div>
                  <label class="block text-sm font-semibold mb-2">Body Weight</label>

                  <div id="weightUSWrap">
                    <input
                      id="weightLb"
                      type="number"
                      inputmode="decimal"
                      placeholder="lbs (e.g. 165)"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                  </div>

                  <div id="weightMetricWrap" class="hidden">
                    <input
                      id="weightKg"
                      type="number"
                      inputmode="decimal"
                      placeholder="kg (e.g. 75)"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                  </div>

                  <p id="weightError" class="hidden mt-2 text-sm text-red-600">Please enter a valid weight.</p>
                </div>

                <!-- Optional Body Fat -->
                <div>
                  <label class="block text-sm font-semibold mb-2">Current Body Fat % (optional)</label>
                  <input
                    id="bodyFat"
                    type="number"
                    inputmode="decimal"
                    placeholder="e.g. 22"
                    class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                           focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                  />
                  <p id="bodyFatError" class="hidden mt-2 text-sm text-red-600">
                    Enter a valid body fat % (3–70).
                  </p>
                </div>

                <!-- Sex + Age -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-semibold mb-2">Sex</label>
                    <select
                      id="sex"
                     class="w-full px-4 py-3 rounded-xl bg-white
       border border-black/10
       ring-0
       focus:border-cc-outline
       focus:ring-2 focus:ring-cc-outline/70
       focus:outline-none transition"

                    >
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold mb-2">Age</label>
                    <input
                      id="age"
                      type="number"
                      inputmode="numeric"
                      placeholder="e.g. 25"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                    <p id="ageError" class="hidden mt-2 text-sm text-red-600">Please enter a valid age.</p>
                  </div>
                </div>

                <!-- Height -->
                <div>
                  <label class="block text-sm font-semibold mb-2">Height</label>

                  <div id="heightUSWrap" class="grid grid-cols-2 gap-3">
                    <input
                      id="heightFt"
                      type="number"
                      inputmode="numeric"
                      placeholder="Feet (e.g. 5)"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                    <input
                      id="heightIn"
                      type="number"
                      inputmode="numeric"
                      placeholder="Inches (e.g. 10)"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                  </div>

                  <div id="heightMetricWrap" class="hidden">
                    <input
                      id="heightCm"
                      type="number"
                      inputmode="decimal"
                      placeholder="cm (e.g. 178)"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                  </div>

                  <p id="heightError" class="hidden mt-2 text-sm text-red-600">Please enter a valid height.</p>
                </div>

                <!-- Activity -->
                <div>
                  <label class="block text-sm font-semibold mb-2">Activity Level</label>
                  <select
                    id="activityLevel"
                  class="w-full px-4 py-3 rounded-xl bg-white
       border border-black/10
       ring-0
       focus:border-cc-outline
       focus:ring-2 focus:ring-cc-outline/70
       focus:outline-none transition"

                  >
                    <option value="sedentary">Sedentary — desk job, little exercise</option>
                    <option value="light">Light — 1–3 workouts/week</option>
                    <option value="moderate" selected>Moderate — 3–5 workouts/week</option>
                    <option value="active">Active — 5–6 workouts/week</option>
                    <option value="veryActive">Very Active — hard training / physical job</option>
                  </select>

                  <div class="mt-2 rounded-2xl p-4 bg-black/5 ring-1 ring-black/5 text-sm">
                    <p class="font-semibold mb-1">How to choose an activity level:</p>
                    <ul class="list-disc list-inside opacity-90 space-y-1">
                      <li>If your job is mostly sitting, start at <span class="font-semibold">Sedentary</span> or <span class="font-semibold">Light</span>.</li>
                      <li>If you train 3–5x/week, <span class="font-semibold">Moderate</span> is usually right.</li>
                      <li><span class="font-semibold">Active/Very Active</span> is for frequent training and/or physical work.</li>
                    </ul>
                  </div>
                </div>

                <!-- Goal -->
                <div>
                  <label class="block text-sm font-semibold mb-2">Goal</label>
                  <div class="rounded-2xl p-4 bg-black/5 ring-1 ring-black/5">
                    <div class="flex items-center justify-between gap-3 flex-wrap">
                      <div>
                        <p class="text-sm font-semibold">Goal Type</p>
                        <p class="text-xs opacity-70">Choose a standard goal or target a specific outcome.</p>
                      </div>
                      <div class="inline-flex rounded-2xl bg-white ring-1 ring-black/10 p-1">
                        <button
                          id="goalModeStandard"
                          type="button"
                          class="goalModeBtn px-4 py-2 rounded-xl text-sm font-bold bg-cc-outline/20 ring-1 ring-cc-outline/30"
                        >
                          Standard
                        </button>
                        <button
                          id="goalModeWeight"
                          type="button"
                          class="goalModeBtn px-4 py-2 rounded-xl text-sm font-bold opacity-70 hover:opacity-100"
                        >
                          Target Weight
                        </button>
                        <button
                          id="goalModeBodyFat"
                          type="button"
                          class="goalModeBtn px-4 py-2 rounded-xl text-sm font-bold opacity-70 hover:opacity-100"
                        >
                          Target Body Fat %
                        </button>
                      </div>
                    </div>
                  </div>

                  <div id="standardGoalWrap" class="mt-4">
                    <div class="grid grid-cols-3 gap-3">
                      <button
                        id="goalLose"
                        type="button"
                        class="goalBtn rounded-xl py-3 font-bold ring-1 ring-black/10 bg-white hover:opacity-90 transition"
                      >
                        Lose
                      </button>
                      <button
                        id="goalMaintain"
                        type="button"
                        class="goalBtn rounded-xl py-3 font-bold ring-2 ring-cc-outline/70 bg-cc-outline/15 hover:opacity-90 transition"
                      >
                        Maintain
                      </button>
                      <button
                        id="goalGain"
                        type="button"
                        class="goalBtn rounded-xl py-3 font-bold ring-1 ring-black/10 bg-white hover:opacity-90 transition"
                      >
                        Gain
                      </button>
                    </div>
                    <p class="text-xs opacity-70 mt-2">
                      Note: Protein + fat targets will adjust by goal (cut/maintain/bulk), not just carbs.
                    </p>
                  </div>

                  <div id="targetWeightWrap" class="hidden mt-4">
                    <label class="block text-sm font-semibold mb-2">Target Body Weight</label>
                    <div id="targetWeightUSWrap">
                      <input
                        id="targetWeightLb"
                        type="number"
                        inputmode="decimal"
                        placeholder="lbs (e.g. 155)"
                        class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                               focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                      />
                    </div>
                    <div id="targetWeightMetricWrap" class="hidden">
                      <input
                        id="targetWeightKg"
                        type="number"
                        inputmode="decimal"
                        placeholder="kg (e.g. 70)"
                        class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                               focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                      />
                    </div>
                    <p id="targetWeightError" class="hidden mt-2 text-sm text-red-600">
                      Please enter a valid target weight.
                    </p>
                    <p class="text-xs opacity-70 mt-2">We’ll infer lose/maintain/gain based on your target.</p>
                  </div>

                  <div id="targetBodyFatWrap" class="hidden mt-4">
                    <label class="block text-sm font-semibold mb-2">Target Body Fat %</label>
                    <input
                      id="targetBodyFat"
                      type="number"
                      inputmode="decimal"
                      placeholder="e.g. 18"
                      class="w-full px-4 py-3 rounded-xl bg-white ring-1 ring-black/10
                             focus:ring-2 focus:ring-cc-outline/70 focus:outline-none transition"
                    />
                    <p id="targetBodyFatError" class="hidden mt-2 text-sm text-red-600">
                      Enter a valid target body fat % (3–70).
                    </p>
                    <p class="text-xs opacity-70 mt-2">
                      Requires your current body fat % above to estimate direction.
                    </p>
                  </div>
                </div>

                <!-- Weekly Change -->
                <div id="weeklyWrap" class="hidden">
                  <label id="weeklyLabel" class="block text-sm font-semibold mb-2">Weekly Change</label>
                  <select
                    id="weeklyChange"
                   class="w-full px-4 py-3 rounded-xl bg-white
       border border-black/10
       ring-0
       focus:border-cc-outline
       focus:ring-2 focus:ring-cc-outline/70
       focus:outline-none transition"

                  ></select>
                  <p class="text-xs opacity-70 mt-2">If adherence is hard, go smaller and stay consistent.</p>
                  <p id="gainNote" class="hidden text-xs text-amber-700 mt-2">
                    For best results, aim to gain no more than 1 lb per week to limit fat gain.
                  </p>
                </div>

                <!-- Calculate -->
                <button
                  id="calcBtn"
                  type="button"
                  class="w-full rounded-2xl py-4 font-extrabold
                         bg-cc-outline text-cc-text hover:opacity-90 transition shadow-outline"
                >
                  Calculate Macros
                </button>

                <!-- Results -->
                <div id="results" class="hidden mt-6 space-y-4">
                  <div class="rounded-2xl p-5 ring-1 ring-black/10 bg-white">
                    <h3 class="text-base sm:text-lg font-bold mb-2 font-heading">Daily Target</h3>
                    <p class="text-3xl sm:text-4xl font-extrabold">
                      <span id="caloriesOut">0</span>
                      <span class="text-xl sm:text-2xl font-bold opacity-70"> calories</span>
                    </p>

                    <p class="text-sm mt-2 opacity-80">
                      BMR: <span id="bmrOut">0</span> calories
                      <span class="opacity-60">(at rest)</span>
                    </p>
                    <p class="text-sm mt-2 opacity-80">
                      TDEE: <span id="tdeeOut">0</span> calories
                      <span class="opacity-60">(BMR + activity)</span>
                    </p>
                  </div>

                  <div
                    id="minCalWarning"
                    class="hidden rounded-2xl p-4 text-sm ring-1 ring-red-300/60 bg-red-50 text-red-900"
                  >
                    <p class="font-semibold">⚠️ Calories raised to daily minimum</p>
                    <p class="mt-1">
                      Based on your goal settings, your target would have been
                      <span class="font-bold"><span id="requestedCaloriesOut">0</span> calories</span>,
                      which is below the daily minimum for your selected sex
                      (<span class="font-bold"><span id="minCaloriesOut">0</span> calories</span>).
                      Calories were adjusted upward for safety and sustainability.
                    </p>
                  </div>

                  <div
                    id="proteinCapBox"
                    class="hidden rounded-2xl p-4 text-sm ring-1 ring-amber-300/60 bg-amber-50 text-amber-900"
                  >
                    <p class="font-semibold">⚠️ Protein capped</p>
                    <p class="mt-1">
                      Protein was capped to keep your macros balanced and sustainable
                      based on your goal and calorie intake
                      (<span id="proteinPctOut">0</span>% of total calories).
                    </p>
                  </div>

                  <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                    <div class="rounded-2xl p-4 ring-1 ring-black/10 bg-[#77d770]/20">
                      <p class="text-sm font-semibold mb-1 opacity-80">Protein</p>
                      <p class="text-2xl sm:text-3xl font-extrabold">
                        <span id="proteinOut">0</span><span class="text-base font-semibold opacity-70">g</span>
                      </p>
                      <p class="text-xs opacity-70 mt-1"><span id="proteinShareOut">0</span>%</p>
                    </div>

                    <div class="rounded-2xl p-4 ring-1 ring-black/10 bg-[#d8c3a5]/30">
                      <p class="text-sm font-semibold mb-1 opacity-80">Carbs</p>
                      <p class="text-2xl sm:text-3xl font-extrabold">
                        <span id="carbsOut">0</span><span class="text-base font-semibold opacity-70">g</span>
                      </p>
                      <p class="text-xs opacity-70 mt-1"><span id="carbsShareOut">0</span>%</p>
                    </div>

                    <div class="rounded-2xl p-4 ring-1 ring-black/10 bg-[#f02348]/20">
                      <p class="text-sm font-semibold mb-1 opacity-80">Fat</p>
                      <p class="text-2xl sm:text-3xl font-extrabold">
                        <span id="fatOut">0</span><span class="text-base font-semibold opacity-70">g</span>
                      </p>
                      <p class="text-xs opacity-70 mt-1"><span id="fatShareOut">0</span>%</p>
                    </div>
                  </div>

                  <div class="rounded-2xl p-4 text-sm ring-1 ring-black/10 bg-white">
                <div>
  <p class="font-extrabold font-heading">Important Note</p>
  <p class="mt-1 opacity-80">
    This is a starting estimate. Your real-world maintenance can be higher/lower. Track for 10–14 days
    and adjust by results.
  </p>
  <ul class="mt-3 space-y-1 list-disc list-inside opacity-90">
    <li><span class="font-semibold">Protein</span> targets ~1g/lb, capped at 180g or 35% of calories.</li>
    <li><span class="font-semibold">Fat</span> supports hormones + satiety.</li>
    <li><span class="font-semibold">Carbs</span> fill remaining calories.</li>
  </ul>
</div>

                    </div>
                  </div>

                  <a
                    href="https://tally.so/r/w5JXKE"
                    target="_blank"
                    rel="noreferrer"
                    class="inline-flex w-full items-center justify-center rounded-2xl px-4 py-4
                           text-sm font-extrabold bg-cc-text text-white hover:opacity-95 transition shadow-soft"
                  >
                    Want this dialed in? Apply for coaching →
                  </a>
                </div>

                <p class="text-xs pt-4 text-center opacity-60">© 2026 Chasing Change — 1% better every day</p>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <script>
      // State
      let goal = "maintain";
      let unit = "us"; // "us" | "metric"
      let goalMode = "standard"; // "standard" | "targetWeight" | "targetBodyFat"

      // Elements
      const sexEl = document.getElementById("sex");
      const ageEl = document.getElementById("age");

      const weightUSWrap = document.getElementById("weightUSWrap");
      const weightMetricWrap = document.getElementById("weightMetricWrap");
      const weightLbEl = document.getElementById("weightLb");
      const weightKgEl = document.getElementById("weightKg");
      const bodyFatEl = document.getElementById("bodyFat");

      const heightUSWrap = document.getElementById("heightUSWrap");
      const heightMetricWrap = document.getElementById("heightMetricWrap");
      const heightFtEl = document.getElementById("heightFt");
      const heightInEl = document.getElementById("heightIn");
      const heightCmEl = document.getElementById("heightCm");

      const ageErrorEl = document.getElementById("ageError");
      const heightErrorEl = document.getElementById("heightError");
      const weightErrorEl = document.getElementById("weightError");
      const bodyFatErrorEl = document.getElementById("bodyFatError");

      const activityEl = document.getElementById("activityLevel");

      const weeklyWrap = document.getElementById("weeklyWrap");
      const weeklyLabel = document.getElementById("weeklyLabel");
      const weeklyEl = document.getElementById("weeklyChange");
      const gainNote = document.getElementById("gainNote");

      const goalModeStandardBtn = document.getElementById("goalModeStandard");
      const goalModeWeightBtn = document.getElementById("goalModeWeight");
      const goalModeBodyFatBtn = document.getElementById("goalModeBodyFat");
      const standardGoalWrap = document.getElementById("standardGoalWrap");
      const targetWeightWrap = document.getElementById("targetWeightWrap");
      const targetBodyFatWrap = document.getElementById("targetBodyFatWrap");

      const targetWeightUSWrap = document.getElementById("targetWeightUSWrap");
      const targetWeightMetricWrap = document.getElementById("targetWeightMetricWrap");
      const targetWeightLbEl = document.getElementById("targetWeightLb");
      const targetWeightKgEl = document.getElementById("targetWeightKg");
      const targetWeightErrorEl = document.getElementById("targetWeightError");

      const targetBodyFatEl = document.getElementById("targetBodyFat");
      const targetBodyFatErrorEl = document.getElementById("targetBodyFatError");

      const resultsEl = document.getElementById("results");
      const proteinCapBox = document.getElementById("proteinCapBox");

      const minCalWarningEl = document.getElementById("minCalWarning");
      const requestedCaloriesOut = document.getElementById("requestedCaloriesOut");
      const minCaloriesOut = document.getElementById("minCaloriesOut");

      // Outputs
      const caloriesOut = document.getElementById("caloriesOut");
      const bmrOut = document.getElementById("bmrOut");
      const tdeeOut = document.getElementById("tdeeOut");
      const proteinOut = document.getElementById("proteinOut");
      const carbsOut = document.getElementById("carbsOut");
      const fatOut = document.getElementById("fatOut");

      const proteinPctOut = document.getElementById("proteinPctOut");
      const proteinShareOut = document.getElementById("proteinShareOut");
      const carbsShareOut = document.getElementById("carbsShareOut");
      const fatShareOut = document.getElementById("fatShareOut");

      const activityFactors = {
        sedentary: 1.2,
        light: 1.375,
        moderate: 1.55,
        active: 1.725,
        veryActive: 1.9,
      };

      function show(el) { el.classList.remove("hidden"); }
      function hide(el) { el.classList.add("hidden"); }

      function setUnit(next) {
        unit = next;

        const usBtn = document.getElementById("unitUS");
        const metBtn = document.getElementById("unitMetric");

        if (unit === "us") {
          usBtn.className = "unitBtn px-4 py-2 rounded-xl text-sm font-bold bg-cc-outline/20 ring-1 ring-cc-outline/30";
          metBtn.className = "unitBtn px-4 py-2 rounded-xl text-sm font-bold opacity-70 hover:opacity-100";
          show(weightUSWrap); hide(weightMetricWrap);
          show(heightUSWrap); hide(heightMetricWrap);
          show(targetWeightUSWrap); hide(targetWeightMetricWrap);
        } else {
          metBtn.className = "unitBtn px-4 py-2 rounded-xl text-sm font-bold bg-cc-outline/20 ring-1 ring-cc-outline/30";
          usBtn.className = "unitBtn px-4 py-2 rounded-xl text-sm font-bold opacity-70 hover:opacity-100";
          hide(weightUSWrap); show(weightMetricWrap);
          hide(heightUSWrap); show(heightMetricWrap);
          hide(targetWeightUSWrap); show(targetWeightMetricWrap);
        }
      }

      function updateWeeklyByGoal(goalValue) {
        if (goalValue === "lose") {
          show(weeklyWrap);
          weeklyLabel.textContent = "Weight Loss per Week";
          hide(gainNote);
          populateWeeklyOptions([0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]);
        } else if (goalValue === "gain") {
          show(weeklyWrap);
          weeklyLabel.textContent = "Weight Gain per Week";
          show(gainNote);
          populateWeeklyOptions([0.25, 0.5, 0.75, 1]);
        } else {
          hide(weeklyWrap);
          hide(gainNote);
        }
      }

      function updateWeeklyByTargets() {
        if (goalMode === "standard") return;

        const { weightLb } = getInputsAsLbsAndInches();
        const bodyFat = parseFloat(bodyFatEl.value);
        const targetWeightLb = getTargetWeightLbs();
        const targetBodyFat = parseFloat(targetBodyFatEl.value);
        const inferredGoal = inferGoalFromTargets(weightLb, bodyFat, targetWeightLb, targetBodyFat);

        updateWeeklyByGoal(inferredGoal);
      }

      function setGoal(newGoal) {
        goal = newGoal;

        document.querySelectorAll(".goalBtn").forEach((btn) => {
          btn.classList.remove("ring-2", "ring-cc-outline/70", "bg-cc-outline/15");
          btn.classList.add("ring-1", "ring-black/10", "bg-white");
        });

        const activeBtn =
          goal === "lose"
            ? document.getElementById("goalLose")
            : goal === "gain"
            ? document.getElementById("goalGain")
            : document.getElementById("goalMaintain");

        activeBtn.classList.remove("ring-1", "ring-black/10", "bg-white");
        activeBtn.classList.add("ring-2", "ring-cc-outline/70", "bg-cc-outline/15");

        updateWeeklyByGoal(goal);
      }

      function setGoalMode(mode) {
        goalMode = mode;

        [goalModeStandardBtn, goalModeWeightBtn, goalModeBodyFatBtn].forEach((btn) => {
          btn.classList.remove("bg-cc-outline/20", "ring-1", "ring-cc-outline/30");
          btn.classList.add("opacity-70");
        });

        if (goalMode === "standard") {
          goalModeStandardBtn.classList.add("bg-cc-outline/20", "ring-1", "ring-cc-outline/30");
          goalModeStandardBtn.classList.remove("opacity-70");
          show(standardGoalWrap);
          hide(targetWeightWrap);
          hide(targetBodyFatWrap);
          updateWeeklyByGoal(goal);
        } else if (goalMode === "targetWeight") {
          goalModeWeightBtn.classList.add("bg-cc-outline/20", "ring-1", "ring-cc-outline/30");
          goalModeWeightBtn.classList.remove("opacity-70");
          hide(standardGoalWrap);
          show(targetWeightWrap);
          hide(targetBodyFatWrap);
          updateWeeklyByTargets();
        } else {
          goalModeBodyFatBtn.classList.add("bg-cc-outline/20", "ring-1", "ring-cc-outline/30");
          goalModeBodyFatBtn.classList.remove("opacity-70");
          hide(standardGoalWrap);
          hide(targetWeightWrap);
          show(targetBodyFatWrap);
          updateWeeklyByTargets();
        }
      }

      function populateWeeklyOptions(values = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]) {
        const previousValue = weeklyEl.value;
        weeklyEl.innerHTML = "";
        values.forEach((v) => {
          const opt = document.createElement("option");
          opt.value = String(v);
          opt.textContent = `${v} lb / week`;
          weeklyEl.appendChild(opt);
        });
        if (values.map(String).includes(previousValue)) {
          weeklyEl.value = previousValue;
        } else {
          weeklyEl.value = values.includes(1) ? "1" : String(values[0]);
        }
      }

      function getInputsAsLbsAndInches() {
        let weightLb;
        let totalInches;

        if (unit === "us") {
          weightLb = parseFloat(weightLbEl.value);
          const ft = parseInt(heightFtEl.value, 10);
          const inch = parseInt(heightInEl.value, 10);
          totalInches = (ft || 0) * 12 + (inch || 0);
        } else {
          const weightKg = parseFloat(weightKgEl.value);
          const heightCm = parseFloat(heightCmEl.value);
          weightLb = weightKg * 2.2046226218;
          totalInches = heightCm / 2.54;
        }

        return { weightLb, totalInches };
      }

      function getTargetWeightLbs() {
        if (unit === "us") {
          return parseFloat(targetWeightLbEl.value);
        }
        const targetWeightKg = parseFloat(targetWeightKgEl.value);
        return targetWeightKg * 2.2046226218;
      }

      function inferGoalFromTargets(currentWeightLb, currentBodyFat, targetWeightLb, targetBodyFat) {
        if (goalMode === "targetWeight" && targetWeightLb) {
          if (targetWeightLb < currentWeightLb) return "lose";
          if (targetWeightLb > currentWeightLb) return "gain";
          return "maintain";
        }

        if (goalMode === "targetBodyFat" && targetBodyFat && currentBodyFat) {
          if (targetBodyFat < currentBodyFat) return "lose";
          if (targetBodyFat > currentBodyFat) return "gain";
          return "maintain";
        }

        return goal;
      }

      function calculate() {
        hide(weightErrorEl);
        hide(ageErrorEl);
        hide(heightErrorEl);
        hide(bodyFatErrorEl);
        hide(targetWeightErrorEl);
        hide(targetBodyFatErrorEl);

        const age = parseInt(ageEl.value, 10);
        const { weightLb, totalInches } = getInputsAsLbsAndInches();
        const bodyFat = parseFloat(bodyFatEl.value);
        const targetWeightLb = getTargetWeightLbs();
        const targetBodyFat = parseFloat(targetBodyFatEl.value);

        let hasError = false;

        if (!weightLb || weightLb <= 0) {
          show(weightErrorEl);
          hasError = true;
        }

        if (!age || age < 10 || age > 100) {
          show(ageErrorEl);
          hasError = true;
        }

        if (!totalInches || totalInches < 48 || totalInches > 84) {
          show(heightErrorEl);
          hasError = true;
        }

        if (bodyFatEl.value && (isNaN(bodyFat) || bodyFat < 3 || bodyFat > 70)) {
          show(bodyFatErrorEl);
          hasError = true;
        }

        if (goalMode === "targetWeight") {
          if (!targetWeightLb || targetWeightLb <= 0) {
            show(targetWeightErrorEl);
            hasError = true;
          }
        }

        if (goalMode === "targetBodyFat") {
          if (!targetBodyFat || targetBodyFat < 3 || targetBodyFat > 70) {
            show(targetBodyFatErrorEl);
            hasError = true;
          }
          if (!bodyFat || bodyFat < 3 || bodyFat > 70) {
            show(bodyFatErrorEl);
            hasError = true;
          }
        }

        if (hasError) return;

        // Conversions for BMR
        const weightKg = weightLb * 0.45359237;
        const heightCm = totalInches * 2.54;

        // Mifflin-St Jeor BMR
        const isMale = sexEl.value === "male";
        const bmr = isMale
          ? 10 * weightKg + 6.25 * heightCm - 5 * age + 5
          : 10 * weightKg + 6.25 * heightCm - 5 * age - 161;

        const tdee = bmr * activityFactors[activityEl.value];

        // Weekly change adjustment
        const weeklyChangeLb = parseFloat(weeklyEl.value || "0");
        const derivedGoal = inferGoalFromTargets(weightLb, bodyFat, targetWeightLb, targetBodyFat);
        let targetCalories = tdee;

        if (derivedGoal === "lose") targetCalories = tdee - weeklyChangeLb * 500; // ~500/day per 1 lb/week
        if (derivedGoal === "gain") targetCalories = tdee + weeklyChangeLb * 300;

        // Daily minimum calories (Male 1500 / Female 1200) + warning
        const minCalories = isMale ? 1500 : 1200;
        const requestedCalories = targetCalories;
        const wasBelowMin = requestedCalories < minCalories;

        targetCalories = Math.max(minCalories, targetCalories);

        if (wasBelowMin) {
          requestedCaloriesOut.textContent = Math.round(requestedCalories);
          minCaloriesOut.textContent = minCalories;
          show(minCalWarningEl);
        } else {
          hide(minCalWarningEl);
        }

        // --- MACROS ---
        // Protein priority: ~1g/lb+, capped by 180g OR 35% calories (whichever comes first)
const proteinPerLb =
  derivedGoal === "lose" ? 1.10 :
  derivedGoal === "gain" ? 1.10 :  // or 1.10 if you want
  1.00;
        const proteinTarget = weightLb * proteinPerLb;

        const proteinHardCap = 180;
        const proteinCalCap = (targetCalories * 0.35) / 4;

        let protein = Math.min(proteinTarget, proteinHardCap, proteinCalCap);
        const proteinCapped = protein < proteinTarget;

        // Fat: % calories + minimum floor
        const fatPct = derivedGoal === "lose" ? 0.25 : derivedGoal === "gain" ? 0.30 : 0.28;
        const fatMin = 45;
        const fatCalTarget = targetCalories * fatPct;

        let fat = Math.max(fatMin, fatCalTarget / 9);

        // Feasibility guard: if protein+fat exceed calories, reduce fat first, then protein
        let proteinCals = protein * 4;
        let fatCals = fat * 9;

        if (proteinCals + fatCals > targetCalories) {
          const remainingForFat = targetCalories - proteinCals;
          fat = Math.max(fatMin, remainingForFat / 9);
          fatCals = fat * 9;

          if (proteinCals + fatCals > targetCalories) {
            const remainingForProtein = targetCalories - fatCals;
            protein = Math.max(0, remainingForProtein / 4);
            proteinCals = protein * 4;
          }
        }

        // Carbs fill remaining calories
        const carbCals = targetCalories - proteinCals - fatCals;
        const carbs = Math.max(0, carbCals / 4);

        // Round outputs
        const caloriesR = Math.round(targetCalories);
        const bmrR = Math.round(bmr);
        const tdeeR = Math.round(tdee);
        const proteinR = Math.round(protein);
        const fatR = Math.round(fat);
        const carbsR = Math.round(carbs);

        caloriesOut.textContent = caloriesR;
        bmrOut.textContent = bmrR;
        tdeeOut.textContent = tdeeR;
        proteinOut.textContent = proteinR;
        carbsOut.textContent = carbsR;
        fatOut.textContent = fatR;

        // Shares
        const proteinPct = Math.round((protein * 4 / targetCalories) * 100);
        const proteinShare = Math.round((proteinR * 4 / caloriesR) * 100);
        const carbsShare = Math.round((carbsR * 4 / caloriesR) * 100);
        const fatShare = Math.round((fatR * 9 / caloriesR) * 100);

        proteinPctOut.textContent = proteinPct;
        proteinShareOut.textContent = proteinShare;
        carbsShareOut.textContent = carbsShare;
        fatShareOut.textContent = fatShare;

        if (proteinCapped) show(proteinCapBox);
        else hide(proteinCapBox);

        show(resultsEl);
      }

      // Init
      setGoal("maintain");
      setGoalMode("standard");
      setUnit("us");

      document.getElementById("unitUS").addEventListener("click", () => setUnit("us"));
      document.getElementById("unitMetric").addEventListener("click", () => setUnit("metric"));

      document.getElementById("goalLose").addEventListener("click", () => setGoal("lose"));
      document.getElementById("goalMaintain").addEventListener("click", () => setGoal("maintain"));
      document.getElementById("goalGain").addEventListener("click", () => setGoal("gain"));
      goalModeStandardBtn.addEventListener("click", () => setGoalMode("standard"));
      goalModeWeightBtn.addEventListener("click", () => setGoalMode("targetWeight"));
      goalModeBodyFatBtn.addEventListener("click", () => setGoalMode("targetBodyFat"));
      [weightLbEl, weightKgEl, bodyFatEl, targetWeightLbEl, targetWeightKgEl, targetBodyFatEl].forEach((el) => {
        el.addEventListener("input", updateWeeklyByTargets);
      });

      document.getElementById("calcBtn").addEventListener("click", calculate);
    </script>
  </body>
</html>
